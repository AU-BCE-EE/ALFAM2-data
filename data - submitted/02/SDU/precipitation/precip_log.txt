
> # Gets precipitation data
> 
> library(gdata)

> library(lubridate)

> library(plyr)

> library(txtplot)

> # Get ALFAM data
> d <- read.xls('../ALFAM2_draft_07-1.xlsx', sheet = 1, skip = 7, header = FALSE, as.is = TRUE)

> # In case there are extra columns, drop them
> d <- d[, 1:71]

> #pubs <- read.xls(file, sheet = 4, skip = 2, header = FALSE, as.is = TRUE)
> 
> # Column types
> # Note furrow measurements are character to be more .... [TRUNCATED] 

> # Column names
> cn <- c('proj', 'pub.id', 'exper', 'field', 'plot', 'treat', 'rep', 'lat', 'long', 'long.dir', 'topo', 'interval', 't.start', 't.en .... [TRUNCATED] 

> # Helps with finding problems in column type vector
> #cbind(1:length(cc), cn, cc)
> 
> # Assign column types
> for(i in 1:ncol(d)) {
+   d[, i] <-  .... [TRUNCATED] 

> # Column names
> names(d) <- cn

> d$row.in.file <- 1:nrow(d)

> d$t.start <- dmy_hm(d$t.start)

> d$t.end <- dmy_hm(d$t.end)

> # Make relative time to make merging easier
> # Note times are rounded to eliminate issue with splitting up rain intervals
> t0 <- min(d$t.start)

> d$t.end.h <- round(as.numeric(difftime(d$t.end, t0, units = 'hours')), 0)

> d$t.start.h <- round(as.numeric(difftime(d$t.start, t0, units = 'hours')), 0)

> # Get precip
> # Inconsistent file data argh!
> d1 <- read.table('Precipitation 1-2 may 2014.csv', sep = ';', header = TRUE)

> d2 <- read.table('Precipitation 1-3 april 2014.csv', sep = ';', dec = ',', header = TRUE)

> d3 <- read.table('Precipitation 13th april 2014 Foulum.csv', sep = ';', header = TRUE)

> d4 <- read.table('Precipitation 30 april 2014.csv', sep = ';', header = TRUE)

> dfsumm(d1)

 48 rows and 4 columns
 48 unique rows
                   Foulum.weather.station.precipitation       date    time    prec
Class                                           integer     factor integer integer
Minimum                                            6069 01-05-2014       0       0
Maximum                                            6069 02-05-2014      23       0
Mean                                               6069 02-05-2014      11       0
Unique (excld. NA)                                    1          2      24       1
Missing values                                        0          0       0       0
Sorted                                             TRUE       TRUE   FALSE    TRUE

> dfsumm(d2)

 72 rows and 5 columns
 72 unique rows
                   Foulum.met.station...precipitation       date    time    prec           X
Class                                         integer     factor integer numeric      factor
Minimum                                          6069 01.04.2014       0       0            
Maximum                                          6069 03.04.2014      23     2.5 Null setzen
Mean                                             6069 02.04.2014      11  0.0667            
Unique (excld. NA)                                  1          3      24       4           2
Missing values                                      0          0       0       0           0
Sorted                                           TRUE       TRUE   FALSE   FALSE       FALSE

> dfsumm(d3)

 48 rows and 4 columns
 48 unique rows
                   station       date    time    prec
Class              integer     factor integer numeric
Minimum               6069 13.04.2014       0       0
Maximum               6069 14.04.2014      23       2
Mean                  6069 14.04.2014      11   0.142
Unique (excld. NA)       1          2      24      10
Missing values           0          0       0       0
Sorted                TRUE       TRUE   FALSE   FALSE

> dfsumm(d4)

 48 rows and 4 columns
 48 unique rows
                   Foulum.precipitation.2nd.barley       date    time    prec
Class                                      integer     factor integer integer
Minimum                                       6069 01-05-2014       0       0
Maximum                                       6069 30-04-2014      23       0
Mean                                          6069 30-04-2014      11       0
Unique (excld. NA)                               1          2      24       1
Missing values                                   0          0       0       0
Sorted                                        TRUE      FALSE   FALSE    TRUE

> names(d1)[1] <- names(d2)[1] <- names(d4)[1] <- 'station'

> head(d1)
  station       date time prec
1    6069 01-05-2014    0    0
2    6069 01-05-2014    1    0
3    6069 01-05-2014    2    0
4    6069 01-05-2014    3    0
5    6069 01-05-2014    4    0
6    6069 01-05-2014    5    0

> head(d2)
  station       date time prec X
1    6069 01.04.2014    0    0  
2    6069 01.04.2014    1    0  
3    6069 01.04.2014    2    0  
4    6069 01.04.2014    3    0  
5    6069 01.04.2014    4    0  
6    6069 01.04.2014    5    0  

> head(d3)
  station       date time prec
1    6069 13.04.2014    0    0
2    6069 13.04.2014    1    0
3    6069 13.04.2014    2    0
4    6069 13.04.2014    3    0
5    6069 13.04.2014    4    0
6    6069 13.04.2014    5    0

> head(d4)
  station       date time prec
1    6069 30-04-2014    0    0
2    6069 30-04-2014    1    0
3    6069 30-04-2014    2    0
4    6069 30-04-2014    3    0
5    6069 30-04-2014    4    0
6    6069 30-04-2014    5    0

> rd <- rbindf(d1, d2, d3, d4)

> dfsumm(rd)

 216 rows and 5 columns
 192 unique rows
                   station       date    time    prec           X
Class              integer     factor integer numeric   character
Minimum               6069 01-05-2014       0       0            
Maximum               6069 30-04-2014      23     2.5 Null setzen
Mean                  6069 02.04.2014      11  0.0537            
Unique (excld. NA)       1          8      24      12           2
Missing values           0          0       0       0         144
Sorted                TRUE      FALSE   FALSE   FALSE       FALSE

> rd$time <- sprintf('%02d', rd$time)

> rd$time <- paste0(rd$time, ':00')

> rd$date.time <- dmy_hm(paste(rd$date, rd$time))

> rd$t.end.h <- round(as.numeric(difftime(rd$date.time, t0, units = 'hours')), 0)

> rd$t.start.h <- rd$t.end.h - 1

> # Look for duplicates--would mean wrong rain totals!
> sort(rd$t.end.h)
  [1] -14 -13 -12 -11 -10  -9  -8  -7  -6  -5  -4  -3  -2  -1   0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
 [52]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303
[103] 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 682 683 684 685 686 687 688 689 690 691 692 693 694 695 696 697 698 699 700 701 702 703 704 705 706 706 707 707 708 708 709 709 710
[154] 710 711 711 712 712 713 713 714 714 715 715 716 716 717 717 718 718 719 719 720 720 721 721 722 722 723 723 724 724 725 725 726 726 727 727 728 728 729 729 730 731 732 733 734 735 736 737 738 739 740 741
[205] 742 743 744 745 746 747 748 749 750 751 752 753

> sum(duplicated(rd$t.end.h))
[1] 24

> rd <- rd[!duplicated(rd$date.time), ]

> sum(duplicated(rd$t.end.h))
[1] 0

> rd <- rd[order(rd$t.end.h), ]

> rd
    station       date  time prec           X           date.time t.end.h t.start.h
49     6069 01.04.2014 00:00  0.0             2014-04-01 00:00:00     -14       -15
50     6069 01.04.2014 01:00  0.0             2014-04-01 01:00:00     -13       -14
51     6069 01.04.2014 02:00  0.0             2014-04-01 02:00:00     -12       -13
52     6069 01.04.2014 03:00  0.0             2014-04-01 03:00:00     -11       -12
53     6069 01.04.2014 04:00  0.0             2014-04-01 04:00:00     -10       -11
54     6069 01.04.2014 05:00  0.0             2014-04-01 05:00:00      -9       -10
55     6069 01.04.2014 06:00  0.0             2014-04-01 06:00:00      -8        -9
56     6069 01.04.2014 07:00  0.0             2014-04-01 07:00:00      -7        -8
57     6069 01.04.2014 08:00  0.0             2014-04-01 08:00:00      -6        -7
58     6069 01.04.2014 09:00  0.0             2014-04-01 09:00:00      -5        -6
59     6069 01.04.2014 10:00  0.0             2014-04-01 10:00:00      -4        -5
60     6069 01.04.2014 11:00  0.0             2014-04-01 11:00:00      -3        -4
61     6069 01.04.2014 12:00  0.0             2014-04-01 12:00:00      -2        -3
62     6069 01.04.2014 13:00  0.0             2014-04-01 13:00:00      -1        -2
63     6069 01.04.2014 14:00  0.0             2014-04-01 14:00:00       0        -1
64     6069 01.04.2014 15:00  0.0             2014-04-01 15:00:00       1         0
65     6069 01.04.2014 16:00  0.0             2014-04-01 16:00:00       2         1
66     6069 01.04.2014 17:00  0.0             2014-04-01 17:00:00       3         2
67     6069 01.04.2014 18:00  0.0             2014-04-01 18:00:00       4         3
68     6069 01.04.2014 19:00  0.0             2014-04-01 19:00:00       5         4
69     6069 01.04.2014 20:00  0.0             2014-04-01 20:00:00       6         5
70     6069 01.04.2014 21:00  0.0             2014-04-01 21:00:00       7         6
71     6069 01.04.2014 22:00  0.0             2014-04-01 22:00:00       8         7
72     6069 01.04.2014 23:00  0.0             2014-04-01 23:00:00       9         8
73     6069 02.04.2014 00:00  0.0             2014-04-02 00:00:00      10         9
74     6069 02.04.2014 01:00  0.0             2014-04-02 01:00:00      11        10
75     6069 02.04.2014 02:00  0.0             2014-04-02 02:00:00      12        11
76     6069 02.04.2014 03:00  0.0             2014-04-02 03:00:00      13        12
77     6069 02.04.2014 04:00  0.0             2014-04-02 04:00:00      14        13
78     6069 02.04.2014 05:00  0.0             2014-04-02 05:00:00      15        14
79     6069 02.04.2014 06:00  0.0             2014-04-02 06:00:00      16        15
80     6069 02.04.2014 07:00  0.0             2014-04-02 07:00:00      17        16
81     6069 02.04.2014 08:00  0.0             2014-04-02 08:00:00      18        17
82     6069 02.04.2014 09:00  0.0             2014-04-02 09:00:00      19        18
83     6069 02.04.2014 10:00  0.0             2014-04-02 10:00:00      20        19
84     6069 02.04.2014 11:00  0.0             2014-04-02 11:00:00      21        20
85     6069 02.04.2014 12:00  0.0             2014-04-02 12:00:00      22        21
86     6069 02.04.2014 13:00  2.2 Null setzen 2014-04-02 13:00:00      23        22
87     6069 02.04.2014 14:00  2.5 Null setzen 2014-04-02 14:00:00      24        23
88     6069 02.04.2014 15:00  0.1             2014-04-02 15:00:00      25        24
89     6069 02.04.2014 16:00  0.0             2014-04-02 16:00:00      26        25
90     6069 02.04.2014 17:00  0.0             2014-04-02 17:00:00      27        26
91     6069 02.04.2014 18:00  0.0             2014-04-02 18:00:00      28        27
92     6069 02.04.2014 19:00  0.0             2014-04-02 19:00:00      29        28
93     6069 02.04.2014 20:00  0.0             2014-04-02 20:00:00      30        29
94     6069 02.04.2014 21:00  0.0             2014-04-02 21:00:00      31        30
95     6069 02.04.2014 22:00  0.0             2014-04-02 22:00:00      32        31
96     6069 02.04.2014 23:00  0.0             2014-04-02 23:00:00      33        32
97     6069 03.04.2014 00:00  0.0             2014-04-03 00:00:00      34        33
98     6069 03.04.2014 01:00  0.0             2014-04-03 01:00:00      35        34
99     6069 03.04.2014 02:00  0.0             2014-04-03 02:00:00      36        35
100    6069 03.04.2014 03:00  0.0             2014-04-03 03:00:00      37        36
101    6069 03.04.2014 04:00  0.0             2014-04-03 04:00:00      38        37
102    6069 03.04.2014 05:00  0.0             2014-04-03 05:00:00      39        38
103    6069 03.04.2014 06:00  0.0             2014-04-03 06:00:00      40        39
104    6069 03.04.2014 07:00  0.0             2014-04-03 07:00:00      41        40
105    6069 03.04.2014 08:00  0.0             2014-04-03 08:00:00      42        41
106    6069 03.04.2014 09:00  0.0             2014-04-03 09:00:00      43        42
107    6069 03.04.2014 10:00  0.0             2014-04-03 10:00:00      44        43
108    6069 03.04.2014 11:00  0.0             2014-04-03 11:00:00      45        44
109    6069 03.04.2014 12:00  0.0             2014-04-03 12:00:00      46        45
110    6069 03.04.2014 13:00  0.0             2014-04-03 13:00:00      47        46
111    6069 03.04.2014 14:00  0.0             2014-04-03 14:00:00      48        47
112    6069 03.04.2014 15:00  0.0             2014-04-03 15:00:00      49        48
113    6069 03.04.2014 16:00  0.0             2014-04-03 16:00:00      50        49
114    6069 03.04.2014 17:00  0.0             2014-04-03 17:00:00      51        50
115    6069 03.04.2014 18:00  0.0             2014-04-03 18:00:00      52        51
116    6069 03.04.2014 19:00  0.0             2014-04-03 19:00:00      53        52
117    6069 03.04.2014 20:00  0.0             2014-04-03 20:00:00      54        53
118    6069 03.04.2014 21:00  0.0             2014-04-03 21:00:00      55        54
119    6069 03.04.2014 22:00  0.0             2014-04-03 22:00:00      56        55
120    6069 03.04.2014 23:00  0.0             2014-04-03 23:00:00      57        56
121    6069 13.04.2014 00:00  0.0        <NA> 2014-04-13 00:00:00     274       273
122    6069 13.04.2014 01:00  0.0        <NA> 2014-04-13 01:00:00     275       274
123    6069 13.04.2014 02:00  0.0        <NA> 2014-04-13 02:00:00     276       275
124    6069 13.04.2014 03:00  0.0        <NA> 2014-04-13 03:00:00     277       276
125    6069 13.04.2014 04:00  0.0        <NA> 2014-04-13 04:00:00     278       277
126    6069 13.04.2014 05:00  0.0        <NA> 2014-04-13 05:00:00     279       278
127    6069 13.04.2014 06:00  0.0        <NA> 2014-04-13 06:00:00     280       279
128    6069 13.04.2014 07:00  0.0        <NA> 2014-04-13 07:00:00     281       280
129    6069 13.04.2014 08:00  0.0        <NA> 2014-04-13 08:00:00     282       281
130    6069 13.04.2014 09:00  0.3        <NA> 2014-04-13 09:00:00     283       282
131    6069 13.04.2014 10:00  0.1        <NA> 2014-04-13 10:00:00     284       283
132    6069 13.04.2014 11:00  0.0        <NA> 2014-04-13 11:00:00     285       284
133    6069 13.04.2014 12:00  0.2        <NA> 2014-04-13 12:00:00     286       285
134    6069 13.04.2014 13:00  0.0        <NA> 2014-04-13 13:00:00     287       286
135    6069 13.04.2014 14:00  0.0        <NA> 2014-04-13 14:00:00     288       287
136    6069 13.04.2014 15:00  0.0        <NA> 2014-04-13 15:00:00     289       288
137    6069 13.04.2014 16:00  0.0        <NA> 2014-04-13 16:00:00     290       289
138    6069 13.04.2014 17:00  0.1        <NA> 2014-04-13 17:00:00     291       290
139    6069 13.04.2014 18:00  0.0        <NA> 2014-04-13 18:00:00     292       291
140    6069 13.04.2014 19:00  0.0        <NA> 2014-04-13 19:00:00     293       292
141    6069 13.04.2014 20:00  0.0        <NA> 2014-04-13 20:00:00     294       293
142    6069 13.04.2014 21:00  0.0        <NA> 2014-04-13 21:00:00     295       294
143    6069 13.04.2014 22:00  1.0        <NA> 2014-04-13 22:00:00     296       295
144    6069 13.04.2014 23:00  0.5        <NA> 2014-04-13 23:00:00     297       296
145    6069 14.04.2014 00:00  0.4        <NA> 2014-04-14 00:00:00     298       297
146    6069 14.04.2014 01:00  0.1        <NA> 2014-04-14 01:00:00     299       298
147    6069 14.04.2014 02:00  0.0        <NA> 2014-04-14 02:00:00     300       299
148    6069 14.04.2014 03:00  0.4        <NA> 2014-04-14 03:00:00     301       300
149    6069 14.04.2014 04:00  2.0        <NA> 2014-04-14 04:00:00     302       301
150    6069 14.04.2014 05:00  0.1        <NA> 2014-04-14 05:00:00     303       302
151    6069 14.04.2014 06:00  0.0        <NA> 2014-04-14 06:00:00     304       303
152    6069 14.04.2014 07:00  0.1        <NA> 2014-04-14 07:00:00     305       304
153    6069 14.04.2014 08:00  0.6        <NA> 2014-04-14 08:00:00     306       305
154    6069 14.04.2014 09:00  0.8        <NA> 2014-04-14 09:00:00     307       306
155    6069 14.04.2014 10:00  0.1        <NA> 2014-04-14 10:00:00     308       307
156    6069 14.04.2014 11:00  0.0        <NA> 2014-04-14 11:00:00     309       308
157    6069 14.04.2014 12:00  0.0        <NA> 2014-04-14 12:00:00     310       309
158    6069 14.04.2014 13:00  0.0        <NA> 2014-04-14 13:00:00     311       310
159    6069 14.04.2014 14:00  0.0        <NA> 2014-04-14 14:00:00     312       311
160    6069 14.04.2014 15:00  0.0        <NA> 2014-04-14 15:00:00     313       312
161    6069 14.04.2014 16:00  0.0        <NA> 2014-04-14 16:00:00     314       313
162    6069 14.04.2014 17:00  0.0        <NA> 2014-04-14 17:00:00     315       314
163    6069 14.04.2014 18:00  0.0        <NA> 2014-04-14 18:00:00     316       315
164    6069 14.04.2014 19:00  0.0        <NA> 2014-04-14 19:00:00     317       316
165    6069 14.04.2014 20:00  0.0        <NA> 2014-04-14 20:00:00     318       317
166    6069 14.04.2014 21:00  0.0        <NA> 2014-04-14 21:00:00     319       318
167    6069 14.04.2014 22:00  0.0        <NA> 2014-04-14 22:00:00     320       319
168    6069 14.04.2014 23:00  0.0        <NA> 2014-04-14 23:00:00     321       320
169    6069 30-04-2014 00:00  0.0        <NA> 2014-04-30 00:00:00     682       681
170    6069 30-04-2014 01:00  0.0        <NA> 2014-04-30 01:00:00     683       682
171    6069 30-04-2014 02:00  0.0        <NA> 2014-04-30 02:00:00     684       683
172    6069 30-04-2014 03:00  0.0        <NA> 2014-04-30 03:00:00     685       684
173    6069 30-04-2014 04:00  0.0        <NA> 2014-04-30 04:00:00     686       685
174    6069 30-04-2014 05:00  0.0        <NA> 2014-04-30 05:00:00     687       686
175    6069 30-04-2014 06:00  0.0        <NA> 2014-04-30 06:00:00     688       687
176    6069 30-04-2014 07:00  0.0        <NA> 2014-04-30 07:00:00     689       688
177    6069 30-04-2014 08:00  0.0        <NA> 2014-04-30 08:00:00     690       689
178    6069 30-04-2014 09:00  0.0        <NA> 2014-04-30 09:00:00     691       690
179    6069 30-04-2014 10:00  0.0        <NA> 2014-04-30 10:00:00     692       691
180    6069 30-04-2014 11:00  0.0        <NA> 2014-04-30 11:00:00     693       692
181    6069 30-04-2014 12:00  0.0        <NA> 2014-04-30 12:00:00     694       693
182    6069 30-04-2014 13:00  0.0        <NA> 2014-04-30 13:00:00     695       694
183    6069 30-04-2014 14:00  0.0        <NA> 2014-04-30 14:00:00     696       695
184    6069 30-04-2014 15:00  0.0        <NA> 2014-04-30 15:00:00     697       696
185    6069 30-04-2014 16:00  0.0        <NA> 2014-04-30 16:00:00     698       697
186    6069 30-04-2014 17:00  0.0        <NA> 2014-04-30 17:00:00     699       698
187    6069 30-04-2014 18:00  0.0        <NA> 2014-04-30 18:00:00     700       699
188    6069 30-04-2014 19:00  0.0        <NA> 2014-04-30 19:00:00     701       700
189    6069 30-04-2014 20:00  0.0        <NA> 2014-04-30 20:00:00     702       701
190    6069 30-04-2014 21:00  0.0        <NA> 2014-04-30 21:00:00     703       702
191    6069 30-04-2014 22:00  0.0        <NA> 2014-04-30 22:00:00     704       703
192    6069 30-04-2014 23:00  0.0        <NA> 2014-04-30 23:00:00     705       704
1      6069 01-05-2014 00:00  0.0        <NA> 2014-05-01 00:00:00     706       705
2      6069 01-05-2014 01:00  0.0        <NA> 2014-05-01 01:00:00     707       706
3      6069 01-05-2014 02:00  0.0        <NA> 2014-05-01 02:00:00     708       707
4      6069 01-05-2014 03:00  0.0        <NA> 2014-05-01 03:00:00     709       708
5      6069 01-05-2014 04:00  0.0        <NA> 2014-05-01 04:00:00     710       709
6      6069 01-05-2014 05:00  0.0        <NA> 2014-05-01 05:00:00     711       710
7      6069 01-05-2014 06:00  0.0        <NA> 2014-05-01 06:00:00     712       711
8      6069 01-05-2014 07:00  0.0        <NA> 2014-05-01 07:00:00     713       712
9      6069 01-05-2014 08:00  0.0        <NA> 2014-05-01 08:00:00     714       713
10     6069 01-05-2014 09:00  0.0        <NA> 2014-05-01 09:00:00     715       714
11     6069 01-05-2014 10:00  0.0        <NA> 2014-05-01 10:00:00     716       715
12     6069 01-05-2014 11:00  0.0        <NA> 2014-05-01 11:00:00     717       716
13     6069 01-05-2014 12:00  0.0        <NA> 2014-05-01 12:00:00     718       717
14     6069 01-05-2014 13:00  0.0        <NA> 2014-05-01 13:00:00     719       718
15     6069 01-05-2014 14:00  0.0        <NA> 2014-05-01 14:00:00     720       719
16     6069 01-05-2014 15:00  0.0        <NA> 2014-05-01 15:00:00     721       720
17     6069 01-05-2014 16:00  0.0        <NA> 2014-05-01 16:00:00     722       721
18     6069 01-05-2014 17:00  0.0        <NA> 2014-05-01 17:00:00     723       722
19     6069 01-05-2014 18:00  0.0        <NA> 2014-05-01 18:00:00     724       723
20     6069 01-05-2014 19:00  0.0        <NA> 2014-05-01 19:00:00     725       724
21     6069 01-05-2014 20:00  0.0        <NA> 2014-05-01 20:00:00     726       725
22     6069 01-05-2014 21:00  0.0        <NA> 2014-05-01 21:00:00     727       726
23     6069 01-05-2014 22:00  0.0        <NA> 2014-05-01 22:00:00     728       727
24     6069 01-05-2014 23:00  0.0        <NA> 2014-05-01 23:00:00     729       728
25     6069 02-05-2014 00:00  0.0        <NA> 2014-05-02 00:00:00     730       729
26     6069 02-05-2014 01:00  0.0        <NA> 2014-05-02 01:00:00     731       730
27     6069 02-05-2014 02:00  0.0        <NA> 2014-05-02 02:00:00     732       731
28     6069 02-05-2014 03:00  0.0        <NA> 2014-05-02 03:00:00     733       732
29     6069 02-05-2014 04:00  0.0        <NA> 2014-05-02 04:00:00     734       733
30     6069 02-05-2014 05:00  0.0        <NA> 2014-05-02 05:00:00     735       734
31     6069 02-05-2014 06:00  0.0        <NA> 2014-05-02 06:00:00     736       735
32     6069 02-05-2014 07:00  0.0        <NA> 2014-05-02 07:00:00     737       736
33     6069 02-05-2014 08:00  0.0        <NA> 2014-05-02 08:00:00     738       737
34     6069 02-05-2014 09:00  0.0        <NA> 2014-05-02 09:00:00     739       738
35     6069 02-05-2014 10:00  0.0        <NA> 2014-05-02 10:00:00     740       739
36     6069 02-05-2014 11:00  0.0        <NA> 2014-05-02 11:00:00     741       740
37     6069 02-05-2014 12:00  0.0        <NA> 2014-05-02 12:00:00     742       741
38     6069 02-05-2014 13:00  0.0        <NA> 2014-05-02 13:00:00     743       742
39     6069 02-05-2014 14:00  0.0        <NA> 2014-05-02 14:00:00     744       743
40     6069 02-05-2014 15:00  0.0        <NA> 2014-05-02 15:00:00     745       744
41     6069 02-05-2014 16:00  0.0        <NA> 2014-05-02 16:00:00     746       745
42     6069 02-05-2014 17:00  0.0        <NA> 2014-05-02 17:00:00     747       746
43     6069 02-05-2014 18:00  0.0        <NA> 2014-05-02 18:00:00     748       747
44     6069 02-05-2014 19:00  0.0        <NA> 2014-05-02 19:00:00     749       748
45     6069 02-05-2014 20:00  0.0        <NA> 2014-05-02 20:00:00     750       749
46     6069 02-05-2014 21:00  0.0        <NA> 2014-05-02 21:00:00     751       750
47     6069 02-05-2014 22:00  0.0        <NA> 2014-05-02 22:00:00     752       751
48     6069 02-05-2014 23:00  0.0        <NA> 2014-05-02 23:00:00     753       752

> # Drop earlier times
> rd <- rd[rd$t.end.h < t0, ]

> # Fill in rain data
> head(rd)
   station       date  time prec X           date.time t.end.h t.start.h
49    6069 01.04.2014 00:00    0   2014-04-01 00:00:00     -14       -15
50    6069 01.04.2014 01:00    0   2014-04-01 01:00:00     -13       -14
51    6069 01.04.2014 02:00    0   2014-04-01 02:00:00     -12       -13
52    6069 01.04.2014 03:00    0   2014-04-01 03:00:00     -11       -12
53    6069 01.04.2014 04:00    0   2014-04-01 04:00:00     -10       -11
54    6069 01.04.2014 05:00    0   2014-04-01 05:00:00      -9       -10

> d$rain <- NA

> for(i in 1:nrow(d)) {
+   
+   t.start <- d$t.start.h[i]
+   t.end <- d$t.end.h[i]
+ 
+   precip <- sum(rd$prec[rd$t.end.h <= t.end & rd$t.start.h > .... [TRUNCATED] 

> # Sort to be safe
> d <- d[order(d$row.in.file), ]

> # Export
> write.csv(d, 'ALFAM_dat_w_rain.csv', row.names = FALSE)

> # Check
> x <- subset(d, exper == 'B1' & plot == '1')

> txtplot(x$t.start.h, x$rain)
  +-------+------------------------------+-------------------------------+------------------------------+-------------------------------+------------------------------+-+
  |                                                                                                                                                                      |
  |                                                                                                                              *                                       |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
4 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
3 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
2 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
1 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                              *       |
0 +       *           *                                                                                                                                                  +
  |                                                                                                                                                                      |
  +-------+------------------------------+-------------------------------+------------------------------+-------------------------------+------------------------------+-+
          0                              5                              10                             15                              20                             25  

> x <- subset(d, exper == 'B1' & plot == 'A')

> txtplot(x$t.start.h, x$rain)
  +-------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+------------------+
  |                                                                                                                                                                      |
  |                                                                          *         *                                                                                 |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
4 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
3 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
2 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
1 +                                                                                                                                                                      +
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                                                                                                      |
  |                                                                                           *                                                                          |
0 +       *      *      *  *                                                    *                                                                                *       +
  |                                                                                                                                                                      |
  +-------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+------------------+
          0                                 10                                 20                                 30                                 40                   

> txtplot(rd$t.start.h, rd$prec)
    +---------+--------------------------------------+--------------------------------------+--------------------------------------+-------------------------------------+
    |                                                                                                                                                                    |
2.5 +              *                                                                                                                                                     +
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |              *                                                                                                                                                     |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
  2 +                                                                    *                                                                                               +
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
1.5 +                                                                                                                                                                    +
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
  1 +                                                                   *                                                                                                +
    |                                                                                                                                                                    |
    |                                                                                                                                                                    |
    |                                                                     *                                                                                              |
    |                                                                                                                                                                    |
    |                                                                    *                                                                                               |
    |                                                                                                                                                                    |
0.5 +                                                                   *                                                                                                +
    |                                                                   **                                                                                               |
    |                                                                                                                                                                    |
    |                                                                *                                                                                                   |
    |                                                                 *                                                                                                  |
    |                                                                                                                                                                    |
    |              *                                                 * ****                                                                                              |
  0 +      ***************                                         **********                                                                     ***************        +
    |                                                                                                                                                                    |
    +---------+--------------------------------------+--------------------------------------+--------------------------------------+-------------------------------------+
              0                                     200                                    400                                    600                                     

> x
      proj pub.id exper            field plot treat rep  lat long long.dir topo interval             t.start               t.end   dt       meas.tech plot.area bg.dl bg.val bg.unit j.NH3 j.NH3.unit clay silt
81  ALFAM2   <NA>    B1 ECO field Foulum    A    SS   1 <NA> <NA>        E Flat        0 2014-04-01 13:31:00 2014-04-01 18:36:00 <NA>             cps        81  <NA>     NA    <NA> 1.043 kg N/ha-hr  6.8  8.2
83  ALFAM2   <NA>    B1 ECO field Foulum    A    SS   1 <NA> <NA>        E Flat        1 2014-04-01 18:36:00 2014-04-02 08:50:00 <NA>             cps        81  <NA>     NA    <NA> 0.204 kg N/ha-hr  6.8  8.2
85  ALFAM2   <NA>    B1 ECO field Foulum    A    SS   1 <NA> <NA>        E Flat        2 2014-04-02 08:50:00 2014-04-02 13:40:00 <NA>             cps        81  <NA>     NA    <NA> 0.310 kg N/ha-hr  6.8  8.2
87  ALFAM2   <NA>    B1 ECO field Foulum    A    SS   1 <NA> <NA>        E Flat        3 2014-04-02 13:40:00 2014-04-03 08:36:00 <NA>             cps        81  <NA>     NA    <NA> 0.065 kg N/ha-hr  6.8  8.2
89  ALFAM2   <NA>    B1 ECO field Foulum    A    SS   1 <NA> <NA>        E Flat        4 2014-04-03 08:36:00 2014-04-03 12:58:00 <NA>             cps        81  <NA>     NA    <NA> 0.075 kg N/ha-hr  6.8  8.2
803 ALFAM2   <NA>    B1 ECO field Foulum    A     A   1 <NA> <NA>        E Flat        0 2014-04-01 13:33:00 2014-04-01 15:27:00 <NA> Dynamic chamber        81  <NA>     NA    <NA> 0.510 kg N/ha-hr  6.8  8.2
804 ALFAM2   <NA>    B1 ECO field Foulum    A     A   1 <NA> <NA>        E Flat        1 2014-04-01 15:27:00 2014-04-01 17:55:00 <NA> Dynamic chamber        81  <NA>     NA    <NA> 0.520 kg N/ha-hr  6.8  8.2
805 ALFAM2   <NA>    B1 ECO field Foulum    A     A   1 <NA> <NA>        E Flat        2 2014-04-01 17:55:00 2014-04-02 09:11:00 <NA> Dynamic chamber        81  <NA>     NA    <NA> 0.310 kg N/ha-hr  6.8  8.2
806 ALFAM2   <NA>    B1 ECO field Foulum    A     A   1 <NA> <NA>        E Flat        3 2014-04-02 09:11:00 2014-04-02 11:16:00 <NA> Dynamic chamber        81  <NA>     NA    <NA> 0.210 kg N/ha-hr  6.8  8.2
807 ALFAM2   <NA>    B1 ECO field Foulum    A     A   1 <NA> <NA>        E Flat        4 2014-04-02 11:16:00 2014-04-02 13:50:00 <NA> Dynamic chamber        81  <NA>     NA    <NA> 0.210 kg N/ha-hr  6.8  8.2
808 ALFAM2   <NA>    B1 ECO field Foulum    A     A   1 <NA> <NA>        E Flat        5 2014-04-02 13:50:00 2014-04-03 08:02:00 <NA> Dynamic chamber        81  <NA>     NA    <NA> 0.130 kg N/ha-hr  6.8  8.2
    sand  oc soil.type soil.water soil.moist soil.ph soil.dens crop.res till air.temp air.temp.z soil.temp soil.temp.z rad wind wind.z rain   rh wind.loc far.loc man.source man.bed man.con man.trt1 man.trt2
81  79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     6.00        100        NA          NA  NA 3.27      2  0.0 74.4    Field    <NA>     Cattle    <NA>  Liquid     None     None
83  79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     5.91        100        NA          NA  NA 4.26      2  0.0 66.5    Field    <NA>     Cattle    <NA>  Liquid     None     None
85  79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     4.03        100        NA          NA  NA 4.33      2  4.7 83.6    Field    <NA>     Cattle    <NA>  Liquid     None     None
87  79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     6.52        100        NA          NA  NA 2.46      2  0.1 73.3    Field    <NA>     Cattle    <NA>  Liquid     None     None
89  79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     3.46        100        NA          NA  NA 4.30      2  0.0 91.9    Field    <NA>     Cattle    <NA>  Liquid     None     None
803 79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     6.00        100        NA          NA  NA 3.36      2  0.0 74.4    Field    <NA>     Cattle    <NA>  Liquid     None     None
804 79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     8.42        100        NA          NA  NA 3.85      2  0.0 57.0    Field    <NA>     Cattle    <NA>  Liquid     None     None
805 79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     6.58        100        NA          NA  NA 3.69      2  0.0 62.7    Field    <NA>     Cattle    <NA>  Liquid     None     None
806 79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     4.24        100        NA          NA  NA 4.18      2  0.0 84.2    Field    <NA>     Cattle    <NA>  Liquid     None     None
807 79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     6.53        100        NA          NA  NA 4.01      2  4.7 76.9    Field    <NA>     Cattle    <NA>  Liquid     None     None
808 79.5 5.5      <NA>         NA        Wet     6.2       1.3      Yes   No     6.46        100        NA          NA  NA 4.41      2  0.1 72.6    Field    <NA>     Cattle    <NA>  Liquid     None     None
    man.stor man.dm man.tkn man.tan man.tic man.ua man.ph        app.start                   app.method app.rate app.rate.unit incorp time.incorp man.area dist.inj furrow.z furrow.w    crop crop.z crop.area lai
81        90    6.5     2.9     1.6      NA     NA    7.2 01-04-2014 13:31 Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA> Stubble     NA        NA  NA
83        90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA> Stubble     NA        NA  NA
85        90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA> Stubble     NA        NA  NA
87        90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA> Stubble     NA        NA  NA
89        90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA> Stubble     NA        NA  NA
803       90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA>             NA        NA  NA
804       90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA>             NA        NA  NA
805       90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA>             NA        NA  NA
806       90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA>             NA        NA  NA
807       90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA>             NA        NA  NA
808       90    6.5     2.9     1.6      NA     NA    7.2                  Band spread or trailing hose       53          t/ha   None                   30       NA     <NA>     <NA>             NA        NA  NA
                                                                              notes row.in.file t.end.h t.start.h
81                                                                                           81       5         0
83                                                                                           83      19         5
85                                                                                           85      24        19
87                                                                                           87      43        24
89                                                                                           89      47        43
803 Surface applied, non acidified and non incoporated before sowing spring barley.         803       2         0
804 Surface applied, non acidified and non incoporated before sowing spring barley.         804       4         2
805 Surface applied, non acidified and non incoporated before sowing spring barley.         805      20         4
806 Surface applied, non acidified and non incoporated before sowing spring barley.         806      22        20
807 Surface applied, non acidified and non incoporated before sowing spring barley.         807      24        22
808 Surface applied, non acidified and non incoporated before sowing spring barley.         808      43        24

> sum(rd$prec)
[1] 11.6

> ddply(d, c('exper', 'plot'), summarise, rain.tot = sum(rain))
    exper plot rain.tot
1      B1    1      4.8
2      B1   11      4.8
3      B1   12      4.8
4      B1   13      4.8
5      B1   15      4.8
6      B1   17      4.8
7      B1   18      4.8
8      B1   20      4.8
9      B1   21      4.8
10     B1   24      4.8
11     B1   28      4.8
12     B1   29      4.8
13     B1    3      4.8
14     B1   32      4.8
15     B1    7      4.8
16     B1    9      4.8
17     B1    A      9.6
18     B1    B      9.6
19     B2    1      0.0
20     B2   10      0.0
21     B2   13      0.0
22     B2   14      0.0
23     B2   19      0.0
24     B2    2      0.0
25     B2   20      0.0
26     B2   22      0.0
27     B2   23      0.0
28     B2   24      0.0
29     B2   25      0.0
30     B2    6      0.0
31     B2    9      0.0
32     B2    M      0.0
33     W1   10      0.0
34     W1   11      0.0
35     W1   12      0.0
36     W1   13      0.0
37     W1   14      0.0
38     W1   15      0.0
39     W1   16      0.0
40     W1   17      0.0
41     W1   19      0.0
42     W1    2      0.0
43     W1   20      0.0
44     W1   21      0.0
45     W1   22      0.0
46     W1   23      0.0
47     W1   24      0.0
48     W1   25      0.0
49     W1   26      0.0
50     W1   28      0.0
51     W1   29      0.0
52     W1   33      0.0
53     W1   34      0.0
54     W1   35      0.0
55     W1   36      0.0
56     W1   37      0.0
57     W1   38      0.0
58     W1   39      0.0
59     W1   40      0.0
60     W1   41      0.0
61     W1   42      0.0
62     W1   44      0.0
63     W1   45      0.0
64     W1   46      0.0
65     W1   47      0.0
66     W1   49      0.0
67     W1    5      0.0
68     W1   50      0.0
69     W1   51      0.0
70     W1   53      0.0
71     W1   55      0.0
72     W1   56      0.0
73     W1   57      0.0
74     W1   58      0.0
75     W1   59      0.0
76     W1    6      0.0
77     W1   60      0.0
78     W1    7      0.0
79     W1    8      0.0
80     W1    9      0.0
81     W1    C      0.0
82     W1   CA      0.0
83     W2    1      0.0
84     W2   10      0.0
85     W2   11      0.0
86     W2   12      0.0
87     W2   13      0.0
88     W2   14      0.0
89     W2   15      0.0
90     W2   16      0.0
91     W2   17      0.0
92     W2   18      0.0
93     W2   19      0.0
94     W2    2      0.0
95     W2   20      0.0
96     W2   21      0.0
97     W2   22      0.0
98     W2   23      0.0
99     W2   24      0.0
100    W2   25      0.0
101    W2   26      0.0
102    W2   27      0.0
103    W2   28      0.0
104    W2   29      0.0
105    W2    3      0.0
106    W2   30      0.0
107    W2   31      0.0
108    W2   32      0.0
109    W2   33      0.0
110    W2   34      0.0
111    W2   35      0.0
112    W2   36      0.0
113    W2   37      0.0
114    W2   38      0.0
115    W2   39      0.0
116    W2    4      0.0
117    W2   40      0.0
118    W2   41      0.0
119    W2   42      0.0
120    W2   43      0.0
121    W2   44      0.0
122    W2   45      0.0
123    W2   46      0.0
124    W2   47      0.0
125    W2   48      0.0
126    W2    5      0.0
127    W2    6      0.0
128    W2    7      0.0
129    W2    8      0.0
130    W2    9      0.0
131    W2    C      0.0

> sum(d$rain)
[1] 96
